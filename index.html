<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ¨Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (Ø­Ø¶ÙˆØ±ÙŠ) - Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø± | Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù…</title>

  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root{
      --primary:#6a2df3;
      --primary-dark:#4b1fad;
      --primary-light:#8a5cf5;
      --secondary:#ff8a3c;
      --accent:#22b8aa;
      --success:#10b981;
      --warning:#f59e0b;
      --danger:#ef4444;
      
      /* Ø£Ù„ÙˆØ§Ù† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ù„Ù„ØªØ¯Ø±Ø¬ */
      --grad-start:#6a2df3;
      --grad-end:#ff8a3c;
      --grad:linear-gradient(135deg, var(--grad-start), var(--grad-end));
      --grad-reverse:linear-gradient(135deg, var(--grad-end), var(--grad-start));
      --grad2:linear-gradient(135deg,#ff8a3c,#ffb37c);
      --bg:linear-gradient(135deg,#f7f4ff,#ffffff);
      
      --text:#15162b;
      --muted:#5d6680;
      
      --r-lg:20px;
      --r-md:12px;
      
      --shadow1:0 10px 25px rgba(106,45,243,.15);
      --shadow2:0 15px 35px rgba(106,45,243,.2);
      --shadow-glow:0 0 30px rgba(106,45,243,.3);
      
      --t:all .25s ease;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Cairo',sans-serif;
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      padding:18px;
    }
    .container{max-width:1050px;margin:0 auto;padding:12px}
    
    /* Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠ */
    .hero-banner{
      background:var(--grad);
      border-radius:var(--r-lg);
      padding:22px;
      margin:10px 0 26px;
      box-shadow:var(--shadow-glow);
      position:relative;
      overflow:hidden;
      border:3px solid rgba(255,255,255,.2);
      animation:gradientShift 8s infinite alternate;
    }
    @keyframes gradientShift{
      0%{--grad-start:#6a2df3; --grad-end:#ff8a3c;}
      50%{--grad-start:#ff8a3c; --grad-end:#22b8aa;}
      100%{--grad-start:#22b8aa; --grad-end:#6a2df3;}
    }
    .hero-banner::before{
      content:'';
      position:absolute;
      top:0;right:0;bottom:0;left:0;
      background:url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
    }
    .hero-content{
      position:relative;
      z-index:2;
      text-align:center;
      color:white;
    }
    .hero-content h2{
      font-size:1.8rem;
      margin-bottom:12px;
      text-shadow:0 2px 10px rgba(0,0,0,.3);
      animation:pulse 2s infinite;
    }
    @keyframes pulse{
      0%{transform:scale(1);}
      50%{transform:scale(1.03);}
      100%{transform:scale(1);}
    }
    .hero-content p{
      font-size:1.2rem;
      margin-bottom:18px;
      font-weight:700;
    }
    .old-price{
      text-decoration:line-through;
      opacity:.8;
      font-size:1.1rem;
    }
    .new-price{
      background:white;
      color:var(--primary);
      padding:4px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:1.4rem;
      display:inline-block;
      margin:0 8px;
      box-shadow:0 5px 15px rgba(0,0,0,.2);
      animation:priceGlow 1.5s infinite alternate;
    }
    @keyframes priceGlow{
      from{box-shadow:0 5px 15px rgba(0,0,0,.2);}
      to{box-shadow:0 5px 20px rgba(255,255,255,.4);}
    }
    .blink{
      animation:blinking 1s infinite;
      display:inline-block;
      margin:0 5px;
    }
    @keyframes blinking{
      0%{opacity:1;}
      50%{opacity:0.3;}
      100%{opacity:1;}
    }
    .hero-features{
      display:flex;
      justify-content:center;
      gap:20px;
      flex-wrap:wrap;
      margin:20px 0;
    }
    .feature{
      background:rgba(255,255,255,.15);
      backdrop-filter:blur(10px);
      border-radius:var(--r-md);
      padding:10px 16px;
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:700;
      border:1px solid rgba(255,255,255,.2);
    }
    .countdown{
      background:rgba(0,0,0,.2);
      border-radius:var(--r-md);
      padding:15px;
      margin-top:15px;
      display:inline-block;
      min-width:300px;
    }
    .countdown p{
      margin-bottom:10px;
      font-size:1.1rem;
    }
    #countdownTimer{
      font-family:'Tajawal', monospace;
      font-size:2.2rem;
      font-weight:900;
      letter-spacing:3px;
      background:rgba(0,0,0,.3);
      padding:10px 20px;
      border-radius:var(--r-md);
      border:2px solid rgba(255,255,255,.3);
      direction:ltr;
      text-shadow:0 0 10px rgba(255,255,255,.5);
    }
    .countdown-segment{
      display:inline-block;
      padding:0 5px;
    }
    .countdown-label{
      font-size:.8rem;
      margin-top:5px;
      opacity:.9;
    }
    
    .header{text-align:center;margin:10px 0 26px}
    .logo-wrap{display:flex;align-items:center;justify-content:center;gap:14px;flex-wrap:wrap}
    .logo-img{
      width:84px;height:84px;border-radius:50%;
      background:#fff;border:3px solid var(--primary-light);
      box-shadow:var(--shadow1);overflow:hidden;
      display:flex;align-items:center;justify-content:center;
    }
    .logo-img img{width:100%;height:100%;object-fit:cover}
    .logo-text{text-align:right}
    .logo-text h1{
      font-size:2rem;font-weight:900;
      background:var(--grad);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .logo-text p{color:var(--muted);font-weight:800}
    .badges{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:14px}
    .badge{
      padding:9px 16px;border-radius:999px;color:#fff;font-weight:900;
      display:inline-flex;align-items:center;gap:8px;
      box-shadow:0 10px 22px rgba(0,0,0,.08);font-size:.95rem;
    }
    .badge.purple{background:var(--grad)}
    .badge.orange{background:var(--grad2)}
    .badge.dark{background:#111827}

    .card{
      background:#fff;border-radius:var(--r-lg);padding:26px;
      box-shadow:var(--shadow2);border:1px solid rgba(106,45,243,.10);
    }

    .progress-steps{
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin:18px 0 18px;position:relative;
    }
    .progress-steps::before{
      content:'';position:absolute;top:16px;left:0;right:0;height:3px;
      background:#e5e7eb;border-radius:999px;z-index:1;
    }
    .progress-bar{
      position:absolute;top:16px;right:0;height:3px;background:var(--primary);
      border-radius:999px;z-index:2;width:0%;transition:var(--t);
    }
    .step{width:120px;text-align:center;position:relative;z-index:3}
    .step-icon{
      width:36px;height:36px;border-radius:50%;
      display:flex;align-items:center;justify-content:center;
      margin:0 auto 8px;background:#e5e7eb;color:var(--muted);
      font-weight:900;transition:var(--t);
    }
    .step-label{font-size:.86rem;color:var(--muted);font-weight:900}
    .step.active .step-icon{background:var(--primary);color:#fff;box-shadow:0 10px 22px rgba(106,45,243,.25)}
    .step.active .step-label{color:var(--primary)}
    .step.completed .step-icon{background:var(--success);color:#fff}

    .form-step{display:none;animation:fade .35s ease}
    .form-step.active{display:block}
    @keyframes fade{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    .form-header{margin-bottom:18px}
    .form-header h2{font-size:1.5rem;color:var(--primary-dark);margin-bottom:6px}
    .form-header p{color:var(--muted);font-weight:800}

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:14px;margin-top:12px;
    }
    label{display:block;margin:0 0 8px;font-weight:900;color:var(--text)}
    .required::after{content:" *";color:var(--danger)}
    input,select,textarea{
      width:100%;padding:12px 14px;border:2px solid #e5e7eb;
      border-radius:var(--r-md);font-family:'Cairo',sans-serif;font-size:1rem;
      outline:none;transition:var(--t);
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(106,45,243,.10);
    }
    .hint{color:var(--muted);font-weight:800;font-size:.88rem;margin-top:6px}
    .error{color:var(--danger);font-weight:900;font-size:.85rem;margin-top:6px;display:none}

    .classes-wrap{margin-top:10px}
    .class-item{
      border:2px solid #e5e7eb;border-radius:var(--r-lg);
      padding:16px;background:#fff;cursor:pointer;transition:var(--t);
      margin:14px 0;position:relative;overflow:hidden;
    }
    .class-item:hover{border-color:var(--primary);transform:translateY(-2px);box-shadow:var(--shadow1)}
    .class-item.selected{border-color:var(--primary);background:rgba(106,45,243,.03)}
    .class-head{display:flex;gap:14px;align-items:center;flex-wrap:wrap}

    .teacher-img{
      width:82px;height:82px;border-radius:50%;
      border:3px solid rgba(106,45,243,.25);
      object-fit:cover;background:#fff;flex:0 0 auto;
      cursor:zoom-in;
    }
    .class-title{font-size:1.1rem;font-weight:900;color:var(--primary-dark)}
    .class-sub{color:var(--muted);font-weight:900;margin-top:2px}
    .meta{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;color:var(--muted);font-weight:900}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;font-weight:900;font-size:.9rem;
    }
    .pill.price{background:rgba(16,185,129,.12);color:#047857}
    .pill.mode{background:rgba(34,184,170,.14);color:#0f766e}
    .pill.seats{background:rgba(239,68,68,.12);color:#991b1b}
    .pill.closed{background:#111827;color:#fff}

    .summary{
      background:#f7f4ff;border-radius:var(--r-md);
      padding:16px;margin-top:16px;border:1px solid rgba(106,45,243,.10);
    }
    .sum-row{
      display:flex;justify-content:space-between;gap:10px;
      padding:8px 0;border-bottom:1px solid rgba(0,0,0,.06);
      font-weight:900;
    }
    .sum-row:last-child{border-bottom:none;color:var(--primary);font-weight:900}
    .sum-row span:last-child{direction:ltr}

    .btns{display:flex;justify-content:space-between;gap:12px;margin-top:18px;flex-wrap:wrap}
    .btn{
      border:none;border-radius:var(--r-md);
      padding:12px 18px;font-family:'Cairo',sans-serif;font-weight:900;
      cursor:pointer;transition:var(--t);
      display:inline-flex;align-items:center;gap:10px;
    }
    .btn.primary{background:var(--grad);color:#fff;box-shadow:var(--shadow1)}
    .btn.primary:hover{transform:translateY(-2px);box-shadow:var(--shadow2)}
    .btn.secondary{background:transparent;color:var(--primary);border:2px solid var(--primary)}
    .btn.secondary:hover{background:rgba(106,45,243,.06)}
    .btn.success{background:var(--success);color:#fff}
    .btn.success:hover{transform:translateY(-2px)}
    .btn.disabled{background:#e5e7eb;color:#9ca3af;cursor:not-allowed}
    .btn.disabled:hover{transform:none}

    .message{
      display:none;margin:14px 0;padding:14px;border-radius:var(--r-md);
      font-weight:900;
    }
    .message.success{display:block;background:rgba(16,185,129,.10);border:1px solid rgba(16,185,129,.25);color:#047857}
    .message.error{display:block;background:rgba(239,68,68,.10);border:1px solid rgba(239,68,68,.25);color:#991b1b}
    .message.info{display:block;background:rgba(106,45,243,.10);border:1px solid rgba(106,45,243,.20);color:var(--primary-dark)}

    .upload{
      border:3px dashed #e5e7eb;border-radius:var(--r-lg);
      padding:20px;text-align:center;cursor:pointer;transition:var(--t);margin-top:10px;
    }
    .upload:hover{border-color:var(--primary);background:rgba(106,45,243,.03)}
    .upload i{font-size:2.2rem;color:var(--primary)}
    .file-preview{
      display:flex;align-items:center;justify-content:space-between;
      margin-top:12px;background:rgba(106,45,243,.06);
      border-radius:var(--r-md);padding:12px;font-weight:900;
    }
    .file-preview button{border:none;background:transparent;color:var(--danger);font-size:1.2rem;cursor:pointer}

    .loader{display:none;text-align:center;padding:14px;margin-top:10px;font-weight:900;color:var(--primary)}
    .spinner{
      width:44px;height:44px;border-radius:50%;
      border:3px solid #e5e7eb;border-top:3px solid var(--primary);
      animation:spin 1s linear infinite;margin:0 auto 10px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .terms{
      background:rgba(106,45,243,.06);
      border-radius:var(--r-md);
      padding:14px;margin-top:14px;font-weight:900;color:var(--muted);
    }
    .terms li{margin:8px 0;list-style:none}
    .terms i{color:var(--accent);margin-left:8px}

    .footer{text-align:center;margin-top:22px;color:var(--muted);font-weight:900;font-size:.92rem}
    .contact{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-top:10px}
    .contact .chip{background:rgba(106,45,243,.06);border-radius:999px;padding:10px 14px;display:flex;align-items:center;gap:8px}
    .contact i{color:var(--primary)}

    .modal{
      position:fixed;inset:0;background:rgba(0,0,0,.65);
      display:none;align-items:center;justify-content:center;
      padding:18px;z-index:9999;
    }
    .modal.show{display:flex}
    .modal-card{
      background:#fff;border-radius:18px;max-width:720px;width:100%;
      box-shadow:0 25px 60px rgba(0,0,0,.35);
      overflow:hidden;
    }
    .modal-top{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 14px;border-bottom:1px solid rgba(0,0,0,.06);
      font-weight:900;
    }
    .modal-top button{
      border:none;background:transparent;cursor:pointer;
      font-size:1.2rem;color:#111827;
    }
    .modal-img{width:100%;max-height:70vh;object-fit:contain;background:#0b0c14}

    @media (max-width:768px){
      .card{padding:18px}
      .step{width:100px}
      .btn{width:100%;justify-content:center}
      .btns{flex-direction:column}
      .class-head{align-items:flex-start}
      .hero-content h2{font-size:1.4rem}
      .new-price{font-size:1.2rem}
      #countdownTimer{font-size:1.8rem}
      .countdown{min-width:250px}
    }
  </style>
</head>

<body>
<div class="container">

  <!-- Ø§Ù„Ø¨Ø§Ù†Ø± Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
  <div class="hero-banner">
    <div class="hero-content">
      <h2><i class="fas fa-gift"></i> Ø¹Ø±Ø¶ Ø®Ø§Øµ Ø¬Ø¯Ø§Ù‹! <span class="blink">ğŸ”¥</span></h2>
      <p>ÙƒØ§Ù† Ø³Ø¹Ø± Ø§Ù„Ø­ØµØ© <span class="old-price">5 Ø±ÙŠØ§Ù„</span> â†’ Ø£ØµØ¨Ø­ <span class="new-price">2 Ø±ÙŠØ§Ù„ ÙÙ‚Ø·</span></p>
      <div class="hero-features">
        <div class="feature"><i class="fas fa-clock"></i> Ø³Ø§Ø¹Ø© ÙˆÙ†ØµÙ ØªØ¯Ø±ÙŠØ¨ Ù…ÙƒØ«Ù</div>
        <div class="feature"><i class="fas fa-users"></i> 10 Ù…Ù‚Ø§Ø¹Ø¯ ÙÙ‚Ø· Ù„ÙƒÙ„ Ù…Ø§Ø¯Ø©</div>
        <div class="feature"><i class="fas fa-chart-line"></i> Ù†Ø³Ø¨Ø© Ù†Ø¬Ø§Ø­ Ø·Ù„Ø§Ø¨Ù†Ø§ 99%</div>
      </div>
      <div class="countdown">
        <p><i class="fas fa-hourglass-half"></i> Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø­ØªÙ‰ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø­ØµØ©:</p>
        <div id="countdownTimer">--:--:--</div>
      </div>
    </div>
  </div>

  <div class="header">
    <div class="logo-wrap">
      <div class="logo-img">
        <img src="https://h.top4top.io/p_3622ov2011.png" alt="Ø´Ø¹Ø§Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù…">
      </div>
      <div class="logo-text">
        <h1>Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</h1>
        <p>Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ¨Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (Ø­Ø¶ÙˆØ±ÙŠ) â€“ Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø± â€“ Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±</p>
      </div>
    </div>

    <div class="badges">
      <div class="badge purple"><i class="fa-solid fa-bolt"></i> Ø±ÙŠØ§Ù„ÙŠÙ† ÙÙ‚Ø· Ù„Ù„Ø­ØµØ©</div>
      <div class="badge orange"><i class="fa-solid fa-chair"></i> 10 Ù…Ù‚Ø§Ø¹Ø¯ Ù„ÙƒÙ„ Ù…Ø§Ø¯Ø©</div>
      <div class="badge dark"><i class="fa-solid fa-location-dot"></i> Ø§Ù„ØªØ¹Ù„ÙŠÙ…: Ø­Ø¶ÙˆØ±ÙŠ</div>
    </div>
  </div>

  <div class="progress-steps">
    <div class="progress-bar" id="progressBar"></div>
    <div class="step active" data-step="1">
      <div class="step-icon">1</div>
      <div class="step-label">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­ØµØµ</div>
    </div>
    <div class="step" data-step="2">
      <div class="step-icon">2</div>
      <div class="step-label">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</div>
    </div>
    <div class="step" data-step="3">
      <div class="step-icon">3</div>
      <div class="step-label">Ø§Ù„ØªØ­ÙˆÙŠÙ„ + Ø§Ù„Ø¥ÙŠØµØ§Ù„</div>
    </div>
    <div class="step" data-step="4">
      <div class="step-icon">4</div>
      <div class="step-label">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</div>
    </div>
  </div>

  <div id="msgBox" class="message info" style="display:none"></div>

  <div class="card">

    <!-- STEP 1 -->
    <div class="form-step active" id="step1">
      <div class="form-header">
        <h2>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø­ØµØµ Ø£ÙˆÙ„Ø§Ù‹</h2>
        <p>Ø§Ø®ØªØ± Ø­ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø£Ùˆ Ø­ØµØªÙŠÙ†. (Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ù„Ù… Ù„ØªÙƒØ¨ÙŠØ±Ù‡Ø§)</p>
      </div>

      <div class="classes-wrap" id="classesWrap"></div>

      <div class="summary">
        <div class="sum-row"><span>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©</span><span id="sumCount">0</span></div>
        <div class="sum-row"><span>Ø³Ø¹Ø± Ø§Ù„Ø­ØµØ©</span><span id="sumPrice">2 Ø±ÙŠØ§Ù„</span></div>
        <div class="sum-row"><span>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</span><span id="sumFinal">0 Ø±ÙŠØ§Ù„</span></div>
      </div>

      <div class="btns">
        <button class="btn secondary disabled" disabled>Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <button class="btn primary" onclick="nextStep()">
          Ø§Ù„ØªØ§Ù„ÙŠ <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="form-step" id="step2">
      <div class="form-header">
        <h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
        <p>Ø§Ù„Ø¢Ù† Ø£ÙƒÙ…Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒâ€¦ Ø«Ù… Ù†Ù†ØªÙ‚Ù„ Ù„Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„.</p>
      </div>

      <div class="grid">
        <div>
          <label class="required" for="studentName">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨ ÙƒØ§Ù…Ù„Ø§Ù‹</label>
          <input id="studentName" type="text" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ ÙˆØ§Ù„Ù‚Ø¨ÙŠÙ„Ø©">
          <div class="error" id="errName">Ù…Ø·Ù„ÙˆØ¨</div>
        </div>

        <div>
          <label class="required" for="grade">Ø§Ù„ØµÙ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ</label>
          <select id="grade">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ØµÙ</option>
            <option value="Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±">Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±</option>
          </select>
          <div class="error" id="errGrade">Ù…Ø·Ù„ÙˆØ¨</div>
        </div>

        <div>
          <label class="required" for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (ÙˆØ§ØªØ³Ø§Ø¨)</label>
          <input id="phone" type="tel" placeholder="Ù…Ø«Ø§Ù„: 95xxxxxx">
          <div class="error" id="errPhone">Ø±Ù‚Ù… ØºÙŠØ± ØµØ­ÙŠØ­</div>
        </div>

        <div>
          <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="email" type="email" placeholder="example@email.com">
        </div>
      </div>

      <div style="margin-top:12px">
        <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <textarea id="notes" rows="3" placeholder="Ø£ÙŠ Ù…Ù„Ø§Ø­Ø¸Ø© Ø®Ø§ØµØ©..."></textarea>
      </div>

      <div class="btns">
        <button class="btn secondary" onclick="prevStep()">
          <i class="fa-solid fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
        </button>
        <button class="btn primary" onclick="nextStep()">
          Ø§Ù„ØªØ§Ù„ÙŠ <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="form-step" id="step3">
      <div class="form-header">
        <h2>Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ + Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„</h2>
        <p>Ø­ÙˆÙ‘Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø«Ù… Ø§Ø±ÙØ¹ ØµÙˆØ±Ø©/Ù…Ù„Ù Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„.</p>
      </div>

      <div class="summary" style="background:rgba(34,184,170,.10);border:1px solid rgba(34,184,170,.25)">
        <div class="sum-row" style="border-bottom:none">
          <span><i class="fa-solid fa-money-bill-wave"></i> Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„</span>
          <span style="font-size:1.2rem;font-weight:900">92147179</span>
        </div>
        <div class="hint" style="margin-top:8px">
          Ø¨Ø¹Ø¯ Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„ Ø³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ ØªØ³Ø¬ÙŠÙ„Ùƒ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨.
        </div>
      </div>

      <div>
        <label class="required">Ø±ÙØ¹ Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
        <div class="upload" onclick="document.getElementById('receiptFile').click()">
          <i class="fa-solid fa-cloud-arrow-up"></i>
          <div style="margin-top:10px;font-weight:900">Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ ØµÙˆØ±Ø©/Ù…Ù„Ù Ø§Ù„Ø¥ÙŠØµØ§Ù„</div>
          <div class="hint">JPG, PNG, PDF (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 5MB)</div>
        </div>
        <input id="receiptFile" type="file" accept="image/*,.pdf" style="display:none" onchange="handleFileUpload(this.files)">
        <div class="error" id="errReceipt">Ù…Ø·Ù„ÙˆØ¨</div>

        <div id="filePreview" style="display:none"></div>
      </div>

      <div class="btns">
        <button class="btn secondary" onclick="prevStep()">
          <i class="fa-solid fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
        </button>
        <button class="btn primary" onclick="nextStep()">
          Ø§Ù„ØªØ§Ù„ÙŠ <i class="fa-solid fa-arrow-left"></i>
        </button>
      </div>
    </div>

    <!-- STEP 4 -->
    <div class="form-step" id="step4">
      <div class="form-header">
        <h2>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</h2>
        <p>Ø±Ø§Ø¬Ø¹ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø«Ù… Ø£Ø±Ø³Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</p>
      </div>

      <div id="resultBox" style="display:none"></div>

      <div id="beforeSubmit">
        <div class="summary">
          <div class="sum-row"><span>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</span><span id="rName">-</span></div>
          <div class="sum-row"><span>Ø§Ù„Ù‡Ø§ØªÙ</span><span id="rPhone">-</span></div>
          <div class="sum-row"><span>Ø§Ù„Ø­ØµØµ</span><span id="rClasses">-</span></div>
          <div class="sum-row"><span>Ø§Ù„Ù…Ø¨Ù„Øº</span><span id="rFinal">-</span></div>
        </div>

        <div class="terms">
          <ul>
            <li><i class="fa-solid fa-circle-check"></i> Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ Ù…Ø­Ø¯ÙˆØ¯Ø© (10) Ù„ÙƒÙ„ Ù…Ø§Ø¯Ø© â€” Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠÙ†ØºÙ„Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ù†Ø¯ Ø§Ù„Ø§ÙƒØªÙ…Ø§Ù„.</li>
            <li><i class="fa-solid fa-circle-check"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙŠÙØ¹ØªÙ…Ø¯ Ø¨Ø¹Ø¯ Ø±ÙØ¹ Ø§Ù„Ø¥ÙŠØµØ§Ù„.</li>
            <li><i class="fa-solid fa-circle-check"></i> Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: <b>74120010</b></li>
          </ul>
        </div>

        <div style="margin-top:14px">
          <label style="display:flex;align-items:center;gap:10px;cursor:pointer;font-weight:900">
            <input type="checkbox" id="agreeTerms" style="width:auto">
            Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…
          </label>
          <div class="error" id="errTerms">Ù…Ø·Ù„ÙˆØ¨</div>
        </div>

        <div class="loader" id="loader">
          <div class="spinner"></div>
          Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨...
        </div>

        <div class="btns">
          <button class="btn secondary" onclick="prevStep()">
            <i class="fa-solid fa-arrow-right"></i> Ø§Ù„Ø³Ø§Ø¨Ù‚
          </button>
          <button class="btn success" id="submitBtn" onclick="submitRegistration()">
            <i class="fa-solid fa-paper-plane"></i> Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
          </button>
        </div>
      </div>
    </div>

  </div>

  <div class="footer">
    <div class="contact">
      <div class="chip"><i class="fa-solid fa-phone"></i> Ù„Ù„ØªÙˆØ§ØµÙ„: 74120010</div>
      <div class="chip"><i class="fa-solid fa-money-bill-wave"></i> Ø±Ù‚Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„: 92147179</div>
      <div class="chip"><i class="fa-solid fa-location-dot"></i> Ø­Ø¶ÙˆØ±ÙŠ â€“ Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø±</div>
    </div>
    <p style="margin-top:10px">Â© 2025 Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…Ù„Ù‡Ù… Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
  </div>

</div>

<!-- Modal -->
<div class="modal" id="imgModal" onclick="closeModal(event)">
  <div class="modal-card" onclick="event.stopPropagation()">
    <div class="modal-top">
      <div id="modalTitle">ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ù„Ù…</div>
      <button onclick="closeModal(event)"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <img id="modalImg" class="modal-img" src="" alt="">
  </div>
</div>

<script>
  // ================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ==================
  const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwzL7LkXVCPUWFETD8_V4txrW6Xo7sbZqmBMVOsBpOMbpTZRb7ULdO7iL5S6cie6DkQ_g/exec'; // Ø¹Ø¯Ù‘Ù„Ù‡ ÙÙ‚Ø·
  const PRICE_PER_CLASS = 2;
  const MAX_SEATS = 10;
  
  // ================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ ==================
  // ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„Ø­ØµØµ (Ø§Ø¶Ø¨Ø· Ø­Ø³Ø¨ Ø¬Ø¯ÙˆÙ„Ùƒ)
  const CLASS_SCHEDULES = {
    'phy12': new Date('2025-12-13T11:00:00'), // Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø± 11:00 Øµ
    'math12': new Date('2025-12-13T18:00:00')  // Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø± 6:00 Ù…
  };

  // ================== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ØµØµ (Ø­Ø¶ÙˆØ±ÙŠ - Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø±) ==================
  const classesData = [
    {
      id: 'phy12',
      subject: 'ÙÙŠØ²ÙŠØ§Ø¡',
      teacher: 'Ø¨Ø¯Ø± Ø§Ù„Ø¹Ø¨Ø±ÙŠ',
      image: 'https://h.top4top.io/p_3629jyv2s3.jpeg',
      day: 'Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø±',
      time: '11:00 â€“ 12:30 Ø¸Ù‡Ø±Ù‹Ø§',
      stage: 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±',
      content: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ© (Ø§Ù„Ù…Ø¬Ø§Ù„Ø§Øª Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠØ© ÙˆÙ‚Ø§Ù†ÙˆÙ† ÙƒÙˆÙ„ÙˆÙ…)'
    },
    {
      id: 'math12',
      subject: 'Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©',
      teacher: 'Ø®Ø§Ù„Ø¯ Ø§Ù„ÙƒÙ„Ø¨Ø§Ù†ÙŠ',
      image: 'https://j.top4top.io/p_3630olt6l1.jpeg',
      day: 'Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø±',
      time: '6:00 â€“ 7:30 Ù…Ø³Ø§Ø¡Ù‹',
      stage: 'Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±',
      content: 'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø´Ø§Ù…Ù„Ø© Ù„Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø© (Ø§Ù„ØªÙØ§Ø¶Ù„) + Ø£Ø³Ø¦Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ù…ØªØ¹Ø¯Ø¯ ÙˆÙ…Ù‚Ø§Ù„ÙŠØ©'
    }
  ];

  // ================== Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ ==================
  let step = 1;
  let selected = [];
  let uploadedFile = null;
  let student = {};

  // Ù…Ù‚Ø§Ø¹Ø¯ (ÙˆØ§Ø¬Ù‡Ø© ÙÙ‚Ø·) â€” Ø§Ù„Ø¥Ù‚ÙØ§Ù„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø§Ù„Ø£ÙØ¶Ù„ ÙŠÙƒÙˆÙ† Ù…Ù† Apps Script
  const seatsKey = 'mulhim_super_inperson_seats_v1';
  const seatsState = loadSeats();

  // ================== ØªÙ‡ÙŠØ¦Ø© ==================
  document.addEventListener('DOMContentLoaded', () => {
    renderClasses();
    updateProgress();
    updateSummaryNumbers();
    startCountdown();
    updateDynamicColors();
  });

  // ================== Ø§Ù„Ø¹Ø¯ Ø§Ù„ØªÙ†Ø§Ø²Ù„ÙŠ ==================
  function startCountdown() {
    function update() {
      const now = new Date();
      let minDiff = Infinity;
      let nextClass = null;
      
      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ø­ØµØ© Ù‚Ø§Ø¯Ù…Ø©
      classesData.forEach(cls => {
        const classTime = CLASS_SCHEDULES[cls.id];
        if (classTime && classTime > now) {
          const diff = classTime - now;
          if (diff < minDiff) {
            minDiff = diff;
            nextClass = cls;
          }
        }
      });
      
      const timerElement = document.getElementById('countdownTimer');
      
      if (!nextClass || minDiff <= 0) {
        // Ø¥Ø°Ø§ Ø¨Ø¯Ø£Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ
        timerElement.innerHTML = "Ø¨Ø¯Ø£Øª Ø§Ù„Ø­ØµØµ!";
        timerElement.style.color = "#ef4444";
        timerElement.style.animation = "blinking 1s infinite";
        return;
      }
      
      // Ø­Ø³Ø§Ø¨ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
      const hours = Math.floor(minDiff / (1000 * 60 * 60));
      const minutes = Math.floor((minDiff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((minDiff % (1000 * 60)) / 1000);
      
      // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
      const timeString = 
        `<span class="countdown-segment">${hours.toString().padStart(2, '0')}</span>:` +
        `<span class="countdown-segment">${minutes.toString().padStart(2, '0')}</span>:` +
        `<span class="countdown-segment">${seconds.toString().padStart(2, '0')}</span>`;
      
      timerElement.innerHTML = timeString;
      
      // ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
      if (hours < 1) {
        timerElement.style.color = "#ef4444"; // Ø£Ø­Ù…Ø± Ø¥Ø°Ø§ Ø£Ù‚Ù„ Ù…Ù† Ø³Ø§Ø¹Ø©
        timerElement.style.animation = "pulse 1s infinite";
      } else if (hours < 6) {
        timerElement.style.color = "#f59e0b"; // Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø¥Ø°Ø§ Ø£Ù‚Ù„ Ù…Ù† 6 Ø³Ø§Ø¹Ø§Øª
        timerElement.style.animation = "pulse 2s infinite";
      } else {
        timerElement.style.color = "#ffffff"; // Ø£Ø¨ÙŠØ¶ Ø¹Ø§Ø¯ÙŠ
        timerElement.style.animation = "none";
      }
    }
    
    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
    update();
    setInterval(update, 1000);
  }

  // ================== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© ==================
  function updateDynamicColors() {
    const hours = new Date().getHours();
    const root = document.documentElement;
    
    // ØªØºÙŠÙŠØ± Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ…
    if (hours >= 6 && hours < 12) {
      // Ø§Ù„ØµØ¨Ø§Ø­: Ø£Ø²Ø±Ù‚ - Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ
      root.style.setProperty('--grad-start', '#3b82f6');
      root.style.setProperty('--grad-end', '#8b5cf6');
    } else if (hours >= 12 && hours < 18) {
      // Ø§Ù„Ø¸Ù‡Ø±: Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ - Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ
      root.style.setProperty('--grad-start', '#6a2df3');
      root.style.setProperty('--grad-end', '#ff8a3c');
    } else {
      // Ø§Ù„Ù…Ø³Ø§Ø¡: Ø£Ø­Ù…Ø± - Ø£Ø±Ø¬ÙˆØ§Ù†ÙŠ
      root.style.setProperty('--grad-start', '#ef4444');
      root.style.setProperty('--grad-end', '#8b5cf6');
    }
    
    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
    setTimeout(updateDynamicColors, 5 * 60 * 1000);
  }

  function loadSeats(){
    try{
      const raw = localStorage.getItem(seatsKey);
      if(raw){
        const obj = JSON.parse(raw);
        classesData.forEach(c => {
          if(typeof obj[c.id] !== 'number') obj[c.id] = MAX_SEATS;
        });
        return obj;
      }
    }catch(e){}
    const init = {};
    classesData.forEach(c => init[c.id] = MAX_SEATS);
    localStorage.setItem(seatsKey, JSON.stringify(init));
    return init;
  }
  function saveSeats(){ localStorage.setItem(seatsKey, JSON.stringify(seatsState)); }

  function setMsg(type, text){
    const box = document.getElementById('msgBox');
    box.className = 'message ' + type;
    box.style.display = 'block';
    box.textContent = text;
    setTimeout(()=> box.style.display='none', 4500);
  }

  function showStep(n){
    document.querySelectorAll('.form-step').forEach(el => el.classList.remove('active'));
    document.getElementById('step'+n).classList.add('active');
    step = n;
    updateProgress();
    if(step === 4) fillReview();
    window.scrollTo({top:0, behavior:'smooth'});
  }

  function updateProgress(){
    const bar = document.getElementById('progressBar');
    const percent = ((step - 1) / 3) * 100;
    bar.style.width = percent + '%';

    document.querySelectorAll('.step').forEach((el, idx) => {
      const num = idx+1;
      el.classList.remove('active','completed');
      if(num < step) el.classList.add('completed');
      else if(num === step) el.classList.add('active');
    });
  }

  function nextStep(){
    if(!validateStep(step)) return;
    if(step === 2) saveStudent();
    showStep(step+1);
  }
  function prevStep(){ showStep(step-1); }

  function hideAllErrors(){ document.querySelectorAll('.error').forEach(e => e.style.display='none'); }
  function showErr(id){ const el = document.getElementById(id); if(el) el.style.display='block'; }

  function validateStep(s){
    hideAllErrors();

    if(s === 1){
      if(selected.length === 0){
        setMsg('error','Ø§Ø®ØªØ± Ø­ØµØ© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ğŸ‘‡');
        return false;
      }
      const closed = selected.find(c => (seatsState[c.id] ?? MAX_SEATS) <= 0);
      if(closed){
        setMsg('error', `Ø¹Ø°Ø±Ù‹Ø§ØŒ ${closed.subject} Ø§ÙƒØªÙ…Ù„Øª Ù…Ù‚Ø§Ø¹Ø¯Ù‡ ÙˆØªÙ… Ø§Ù„Ø¥ØºÙ„Ø§Ù‚.`);
        return false;
      }
      return true;
    }

    if(s === 2){
      const name = document.getElementById('studentName').value.trim();
      const grade = document.getElementById('grade').value;
      const phone = document.getElementById('phone').value.trim();

      let ok = true;
      if(!name){ showErr('errName'); ok=false; }
      if(!grade){ showErr('errGrade'); ok=false; }
      if(!phone || !/^\d{8,9}$/.test(phone)){ showErr('errPhone'); ok=false; }
      return ok;
    }

    if(s === 3){
      if(!uploadedFile){ showErr('errReceipt'); return false; }
      return true;
    }

    if(s === 4){
      if(!document.getElementById('agreeTerms').checked){ showErr('errTerms'); return false; }
      return true;
    }

    return true;
  }

  function saveStudent(){
    student = {
      name: document.getElementById('studentName').value.trim(),
      grade: document.getElementById('grade').value,
      phone: document.getElementById('phone').value.trim(),
      email: document.getElementById('email').value.trim(),
      notes: document.getElementById('notes').value.trim(),
    };
  }

  function renderClasses(){
    const wrap = document.getElementById('classesWrap');
    wrap.innerHTML = '';

    classesData.forEach(cls => {
      const seatsLeft = seatsState[cls.id] ?? MAX_SEATS;
      const isClosed = seatsLeft <= 0;

      const div = document.createElement('div');
      div.className = 'class-item';
      div.setAttribute('data-id', cls.id);

      if(isClosed){
        div.style.opacity = '0.55';
        div.style.pointerEvents = 'none';
      }

      div.onclick = () => selectClass(cls.id);

      div.innerHTML = `
        <div class="class-head">
          <img class="teacher-img" src="${cls.image}" alt="${cls.teacher}" onerror="this.src='https://via.placeholder.com/120?text=Teacher'" onclick="openModal('${cls.image}','${cls.teacher}')">
          <div>
            <div class="class-title">${cls.subject} â€“ ${cls.stage}</div>
            <div class="class-sub">ğŸ‘¨â€ğŸ« ${cls.teacher}</div>
            <div class="meta">
              <span><i class="fa-regular fa-calendar"></i> ${cls.day}</span>
              <span><i class="fa-regular fa-clock"></i> ${cls.time}</span>
            </div>
            <div class="hint" style="margin-top:8px">${cls.content}</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap">
          <div class="pill mode"><i class="fa-solid fa-location-dot"></i> Ø­Ø¶ÙˆØ±ÙŠ</div>
          <div class="pill price"><i class="fa-solid fa-tag"></i> ${PRICE_PER_CLASS} Ø±ÙŠØ§Ù„</div>
          ${
            isClosed
              ? `<div class="pill closed"><i class="fa-solid fa-lock"></i> Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØºÙ„Ù‚</div>`
              : `<div class="pill seats"><i class="fa-solid fa-chair"></i> Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${seatsLeft}</div>`
          }
        </div>
      `;

      wrap.appendChild(div);
    });

    selected.forEach(s => {
      const el = document.querySelector(`.class-item[data-id="${s.id}"]`);
      if(el) el.classList.add('selected');
    });
  }

  function selectClass(id){
    const cls = classesData.find(c => c.id === id);
    if(!cls) return;

    if((seatsState[id] ?? MAX_SEATS) <= 0){
      setMsg('error','Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ù…ØºÙ„Ù‚ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø§Ø¯Ø©.');
      return;
    }

    const idx = selected.findIndex(x => x.id === id);
    const el = document.querySelector(`.class-item[data-id="${id}"]`);

    if(idx === -1){
      selected.push(cls);
      el.classList.add('selected');
    }else{
      selected.splice(idx,1);
      el.classList.remove('selected');
    }

    updateSummaryNumbers();
  }

  function updateSummaryNumbers(){
    const count = selected.length;
    const final = count * PRICE_PER_CLASS;
    document.getElementById('sumCount').textContent = count;
    document.getElementById('sumFinal').textContent = final + ' Ø±ÙŠØ§Ù„';
  }

  function handleFileUpload(files){
    if(!files || !files.length) return;
    const file = files[0];

    if(file.size > 5 * 1024 * 1024){
      setMsg('error','Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ (Ø£Ù‚ØµÙ‰ Ø­Ø¯ 5MB).');
      return;
    }
    const okType = file.type.includes('image') || file.type === 'application/pdf';
    if(!okType){
      setMsg('error','Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£Ùˆ PDF.');
      return;
    }

    uploadedFile = file;
    document.getElementById('errReceipt').style.display='none';

    const preview = document.getElementById('filePreview');
    preview.style.display = 'block';
    preview.innerHTML = `
      <div class="file-preview">
        <div style="display:flex;gap:10px;align-items:center">
          <i class="fa-solid ${file.type.includes('image') ? 'fa-file-image' : 'fa-file-pdf'}" style="color:var(--primary);font-size:1.4rem"></i>
          <div>
            <div>${file.name}</div>
            <div class="hint">${(file.size/1024).toFixed(1)} KB</div>
          </div>
        </div>
        <button onclick="removeFile()" title="Ø­Ø°Ù"><i class="fa-solid fa-xmark"></i></button>
      </div>
    `;
  }
  function removeFile(){
    uploadedFile = null;
    document.getElementById('receiptFile').value = '';
    document.getElementById('filePreview').style.display = 'none';
  }

  function fillReview(){
    if(!student.name) saveStudent();

    const details = selected.map(c => `${c.subject} (${c.teacher}) â€“ ${c.day} ${c.time}`).join(' | ');
    const final = selected.length * PRICE_PER_CLASS;

    document.getElementById('rName').textContent = student.name || '-';
    document.getElementById('rPhone').textContent = student.phone || '-';
    document.getElementById('rClasses').textContent = details || '-';
    document.getElementById('rFinal').textContent = final + ' Ø±ÙŠØ§Ù„';
  }

  async function submitRegistration(){
    if(!validateStep(4)) return;

    if(!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes('Ø¶Ø¹_Ù‡Ù†Ø§')){
      setMsg('error','Ø¶Ø¹ Ø±Ø§Ø¨Ø· Google Script Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø£ÙˆÙ„Ø§Ù‹.');
      return;
    }

    const btn = document.getElementById('submitBtn');
    btn.classList.add('disabled');
    btn.disabled = true;

    document.getElementById('loader').style.display='block';

    const count = selected.length;
    const total = count * PRICE_PER_CLASS;

    const classesNames = selected.map(c => c.subject).join('ØŒ ');
    const classesDetails = selected.map(c => `${c.subject} - ${c.teacher} - ${c.day} ${c.time}`).join(' | ');

    const payload = {
      action: 'submit',
      mode: 'Ø­Ø¶ÙˆØ±ÙŠ',
      date: 'Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø±',
      offer: 'Ø³ÙˆØ¨Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (2 Ø±ÙŠØ§Ù„ Ù„Ù„Ø­ØµØ©)',
      name: student.name,
      grade: student.grade,
      phone: student.phone,
      email: student.email,
      classes: classesNames,
      notes: student.notes,
      count: String(count),
      total: String(total),
      discount: '0',
      final: String(total),
      file: uploadedFile ? uploadedFile.name : '',
      extra: classesDetails
    };

    try{
      const params = new URLSearchParams();
      Object.keys(payload).forEach(k => params.append(k, payload[k]));

      const res = await fetch(GOOGLE_SCRIPT_URL, {
        method: 'POST',
        headers: {'Content-Type':'application/x-www-form-urlencoded'},
        body: params.toString()
      });

      const data = await res.json();

      if(data.success){
        selected.forEach(c => seatsState[c.id] = Math.max(0, (seatsState[c.id] ?? MAX_SEATS) - 1));
        saveSeats();

        showSuccess(data.ref || ('MUL-' + Date.now()));
      }else{
        setMsg('error','ÙØ´Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + (data.message || ''));
        btn.disabled = false;
        btn.classList.remove('disabled');
      }
    }catch(err){
      setMsg('error','Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + err.message);
      btn.disabled = false;
      btn.classList.remove('disabled');
    }finally{
      document.getElementById('loader').style.display='none';
    }
  }

  function showSuccess(refId){
    document.getElementById('beforeSubmit').style.display='none';

    const final = selected.length * PRICE_PER_CLASS;

    const result = document.getElementById('resultBox');
    result.style.display='block';
    result.innerHTML = `
      <div class="message success" style="display:block">
        <i class="fa-solid fa-circle-check"></i> ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…
      </div>

      <div class="summary" style="background:#fff;border:2px dashed rgba(16,185,129,.45)">
        <div class="sum-row"><span>Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹</span><span style="font-weight:900">${refId}</span></div>
        <div class="sum-row"><span>Ø§Ù„Ø·Ø§Ù„Ø¨</span><span>${student.name}</span></div>
        <div class="sum-row"><span>Ø§Ù„Ù‡Ø§ØªÙ</span><span>${student.phone}</span></div>
        <div class="sum-row"><span>Ø¹Ø¯Ø¯ Ø§Ù„Ø­ØµØµ</span><span>${selected.length}</span></div>
        <div class="sum-row"><span>Ø§Ù„Ù…Ø¨Ù„Øº</span><span>${final} Ø±ÙŠØ§Ù„</span></div>
      </div>

      <div class="btns">
        <button class="btn primary" onclick="shareWhatsApp('${refId}')">
          <i class="fa-brands fa-whatsapp"></i> Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ù„Ø®Øµ ÙˆØ§ØªØ³Ø§Ø¨
        </button>
        <button class="btn secondary" onclick="copySummary('${refId}')">
          <i class="fa-regular fa-copy"></i> Ù†Ø³Ø® Ø§Ù„Ù…Ù„Ø®Øµ
        </button>
        <button class="btn success" onclick="resetAll()">
          <i class="fa-solid fa-plus"></i> ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
        </button>
      </div>

      <div class="hint" style="margin-top:12px">
        âœ… Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„. Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 74120010
      </div>
    `;

    renderClasses();
  }

  function buildSummaryText(refId){
    const final = selected.length * PRICE_PER_CLASS;
    const list = selected.map(c => `â€¢ ${c.subject} â€“ ${c.teacher} â€“ ${c.day} ${c.time}`).join('\n');

    return `ğŸ“ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ - Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ¨Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (Ø­Ø¶ÙˆØ±ÙŠ)
Ø§Ù„ØªØ§Ø±ÙŠØ®: Ø§Ù„Ø³Ø¨Øª 13 Ø¯ÙŠØ³Ù…Ø¨Ø±
Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹: ${refId}
Ø§Ù„Ø·Ø§Ù„Ø¨: ${student.name}
Ø§Ù„ØµÙ: ${student.grade}
Ø§Ù„Ù‡Ø§ØªÙ: ${student.phone}

Ø§Ù„Ø­ØµØµ:
${list}

Ø§Ù„Ù…Ø¨Ù„Øº: ${final} Ø±ÙŠØ§Ù„
Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø±: 74120010`;
  }

  function shareWhatsApp(refId){
    const txt = buildSummaryText(refId);
    window.open('https://wa.me/?text=' + encodeURIComponent(txt), '_blank');
  }

  async function copySummary(refId){
    const txt = buildSummaryText(refId);
    try{ await navigator.clipboard.writeText(txt); setMsg('success','ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ù„Ø®Øµ âœ…'); }
    catch(e){ prompt('Ø§Ù†Ø³Ø® Ø§Ù„Ù…Ù„Ø®Øµ ÙŠØ¯ÙˆÙŠÙ‹Ø§:', txt); }
  }

  function resetAll(){
    selected = [];
    uploadedFile = null;
    student = {};
    step = 1;

    document.getElementById('studentName').value = '';
    document.getElementById('grade').value = '';
    document.getElementById('phone').value = '';
    document.getElementById('email').value = '';
    document.getElementById('notes').value = '';
    document.getElementById('agreeTerms').checked = false;

    document.getElementById('receiptFile').value = '';
    document.getElementById('filePreview').style.display='none';
    document.getElementById('beforeSubmit').style.display='block';
    document.getElementById('resultBox').style.display='none';

    const btn = document.getElementById('submitBtn');
    btn.disabled = false;
    btn.classList.remove('disabled');

    renderClasses();
    updateSummaryNumbers();
    showStep(1);
  }

  function openModal(src, title){
    const modal = document.getElementById('imgModal');
    document.getElementById('modalImg').src = src;
    document.getElementById('modalTitle').textContent = 'ØµÙˆØ±Ø©: ' + title + ' (Ø§Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¥ØºÙ„Ø§Ù‚)';
    modal.classList.add('show');
  }
  function closeModal(e){
    if(e) e.preventDefault();
    document.getElementById('imgModal').classList.remove('show');
  }
</script>
</body>
</html>

